@page "/customers"
@using BusinessTracking.Models
@using System.Net.Http
@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Components.Authorization
@using Microsoft.AspNetCore.Components.Forms
@using Microsoft.AspNetCore.Components.Routing
@using Microsoft.AspNetCore.Components.Web
@using Microsoft.JSInterop
@using BusinessTracking.Services
@inject BusinessTracking.Services.DatabaseService DatabaseService


<head>
    <style>
            <link href="Styles/Customer.css" rel="stylesheet" />
    </style>
</head>
<h3>Customer Management</h3>

<div>
    <h4>Add New Customer</h4>
    <input @bind="newCustomer.Name" placeholder="Name" />
    <input @bind="newCustomer.Address" placeholder="Address" />
    <input @bind="newCustomer.PhoneNumber" placeholder="Phone Number" />
    <input @bind="newCustomer.Email" placeholder="Email" />
    <input @bind="newCustomer.Notes" placeholder="Notes" />
    <button class="btn btn-success" @onclick="() => ButtonClickEvent(newCustomer)">Add New Customer</button>
</div>

@if (customers != null)
{
    <table class="table">
        <thead>
            <tr>
                <th>Customer ID</th>
                <th>Name</th>
                <th>Address</th>
                <th>Phone Number</th>
                <th>Email</th>
                <th>Notes</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var customer in customers)
            {
                <tr>
                    <td>@customer.Id</td>
                    <td>@customer.Name</td>
                    <td>@customer.Address</td>
                    <td>@customer.PhoneNumber</td>
                    <td>@customer.Email</td>
                    <td>@customer.Notes</td>
                </tr>
            }
        </tbody>
    </table>
}

@code {
    private List<Customer> customers = new List<Customer>();
    private Customer newCustomer = new Customer();
    protected async Task ButtonClickEvent(Customer customer)
    {
        await DatabaseService.CreateCustomer(customer);
    }
    protected override async Task OnInitializedAsync()
    {
        customers = await DatabaseService.FetchCustomers<Customer>();
    }
}
